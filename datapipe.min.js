function init_data_pipe(t,n,o="json"){o=o.toLowerCase(),t.getGlobal();let e=t.script.name;fetch("https://psych-studies.com/datapipe/"+n.split("").map(t=>t.charCodeAt(0)).reduce((t,n)=>t+((t<<7)+(t<<3))^n).toString(16));let i=Date.now().toString(16)+Math.floor(1e4*Math.random()).toString(16);t.addSettings("logger",{onRow:function(t,n,o,s){if(t===e){s.logs=[],s.type="anonymous manager";return}s.type="task",n.sessionId=i,s.logs||(s.logs=[]),s.logs.push(n)},onEnd:function(t,n,o){return o.logs},serialize:function(t,n,o,e){return n},send:function(t,s,r,a){let p="";if("csv"===o&&(p=toCsv(pivot(s))),"tsv"===o&&(p=toCsv(pivot(s),"	")),"json"===o&&(p=JSON.stringify(s)),p&&"task"===a.type&&t!==e)return fetch("https://pipe.jspsych.org/api/data/",{method:"POST",headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify({experimentID:n,filename:t+"_"+i+"."+o,data:p})})}})}function pivot(t){var n=new Map,o=t.map(t=>(function t(o,e,i){if(Object(i)!==i){var s=e.join(".");o[(n.has(s)?n:n.set(s,n.size)).get(s)]=i}else for(var r in i)t(o,"0"==r?e:e.concat(r),i[r]);return o})([],[],t));return[[...n.keys()],...o]}function toCsv(t,n=","){return t.map(t=>t.map(t=>isNaN(t)?JSON.stringify(t):+t).join(n)).join("\n")}
